#!/user/mojedasa/python/Python-2.7.11/python

import sys
import time
if len(sys.argv) != 2:
	print "Argument missing: slotNumber"
        print "e.g.: ", sys.argv[0], "5"
	exit(0)
else:
	msg = "MasterDDS is in slot " + str(int(sys.argv[1])) + "? (y/n)"
        if raw_input(msg) != 'y':
                print "Canceled."
                exit(0)



import mdds
slot = int(sys.argv[1])
mod = mdds.mdds(slot)

# to generate a bash script;
FILENAME_SH = "test.sh"
ts = str(time.strftime('%y.%m.%d %H:%M', time.localtime(time.time())))
sh_header = '# Generated by "./init_mdds" on '+ ts + '''

# A script to setup a MasterDDS module 
#
# To generate f_out =  354630882.619 Hz (FTW_out = 0x35922dd6)
# - The module needs to receive (over backplane SerDes) an FTW value = 0x1999999a
# - ADC gain set to zero


if [ $# -eq 0 ]; 
    then echo "enter the slot number!"
    exit
fi
MasterSlot=$1

'''
with open(FILENAME_SH, "w") as fd:
        fd.write(sh_header)


print '========================================'
print 'Initialize MasterDDS'
mod.init_module()


# to generate a bash script;
import os
import stat
st  = os.stat(FILENAME_SH)
os.chmod(FILENAME_SH, st.st_mode | stat.S_IEXEC | stat.S_IXOTH | stat.S_IXGRP)

print 'Done'

